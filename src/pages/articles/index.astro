---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import RssIcon from "../../components/icons/RssIcon.astro";
import ExternalLinkIcon from "../../components/icons/ExternalLinkIcon.astro";
import { getWritingEntries } from "../../lib/writing";

const articles = await getWritingEntries();

const formatDate = (date: Date) => {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
    timeZone: "UTC",
  });
};
---

<Layout title="Articles | Philippe Serhal">
  <div class="bg-background text-foreground min-h-screen flex flex-col">
    <Header />
    <main class="flex-grow container py-12">
      <div class="flex items-center gap-4 mb-12">
        <h1 class="section-title mb-0">Articles</h1>
        <a
          href="/rss.xml"
          class="text-muted-foreground hover:text-primary transition-colors"
          aria-label="RSS Feed"
          title="RSS Feed"
        >
          <RssIcon size={24} />
        </a>
      </div>

      <div class="grid gap-12 max-w-6xl">
        {
          articles.map((article, i) => (
            <article class="group relative pl-6 border-l-2 border-border hover:border-primary transition-colors duration-300">
              <a
                href={article.href}
                class="block"
                target={article.isExternal ? "_blank" : undefined}
                rel={article.isExternal ? "noreferrer" : undefined}
              >
                <div class="absolute -left-[9px] top-0 h-4 w-4 bg-background border-2 border-border group-hover:border-primary rounded-full transition-colors duration-300" />

                <div class="flex flex-col gap-2 mb-3">
                  <div class="flex flex-col md:flex-row md:items-start gap-2 md:gap-4">
                    <span class="font-mono text-primary text-sm font-bold mt-1.5">
                      [{i}]
                    </span>
                    <h2 class="text-2xl font-bold group-hover:text-primary transition-colors flex flex-wrap items-center gap-2">
                      <span>{article.title}</span>
                      {article.isExternal && article.externalLabel && (
                        <span class="inline-flex items-center rounded-full border border-primary/30 bg-primary/10 px-2 py-0.5 text-[10px] font-mono text-primary">
                          {article.externalLabel}
                        </span>
                      )}
                      {article.isExternal && <ExternalLinkIcon size={18} />}
                    </h2>
                  </div>
                  <time class="text-xs font-mono text-muted-foreground pl-0 md:pl-6">
                    {formatDate(article.pubDate)}
                  </time>
                </div>

                <p class="text-muted-foreground mb-4 pl-0 md:pl-6 max-w-none leading-relaxed">
                  {article.description}
                </p>
              </a>
            </article>
          ))
        }
      </div>
    </main>
    <Footer />
  </div>
</Layout>
